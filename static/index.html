<!DOCTYPE html>
<html>
<head>
	<title>Driver HUD</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" type="text/css" href="style.css">
	<script type="text/javascript">
		window.onload = () => {
			clockTick();
			updateData();
			
			setInterval(clockTick, 1000);
			setInterval(updateData, 100);
		}
		
		function clockTick() {
			let d = new Date();
			let hour = ((d.getHours() % 12) || 12);
			//hour = (hour < 10 ? "&nbsp;" : "") + hour; // Pad hour
			let colon = d.getSeconds() % 2 ? ":" : " ";
			let min = (d.getMinutes() < 10 ? "0" : "") + d.getMinutes()
			let amOrPm = d.getHours() >= 12 ? "pm" : "am";
			document.getElementById("clock").innerHTML = hour + colon + min + amOrPm;
		}
		
		function readSensor(endpoint, callback) {
			let xhttp = new XMLHttpRequest();
			xhttp.onreadystatechange = function() {
				if (this.readyState == 4 && this.status == 200) {
					callback(this.response);
				} else {
					// Display error to driver?
				}
			};
			xhttp.open("GET", endpoint + "?" + Date.now(), true); // Date.now() prevents caching
			xhttp.send();
		}

		function populateData(data) {
			console.log(data);
			document.getElementById("battery-percent").innerText = data["soc"];
			document.getElementById("temperature").innerHTML = data["temp"];
		} 

		function updateData() {
			readSensor("/get-data", data => populateData(JSON.parse(data)));
		}

		// Not yet implemented in Flask
		/*function updateError() {
			readSensor("/get-bps-error", error => document.getElementById("error").style.display = error ? "block" : "none");
		}*/
	</script>
</head>
<body onclick="location.reload()"> <!-- Tap anywhere to reload in case something breaks -->
	<div class="grid">
		<div class="dataViewer" id="time">
			<span id="clock"></span>
		</div>
		<div class="dataViewer" id="soc">
			<span id="battery-percent"></span>%
		</div>
	</div>
</body>
</html>
